/*!
 * ExtAutoInject
 * Part of the ExtHelpers project
 * @version  v1.4.1
 * @author   Gerrproger
 * @license  MIT License
 * Repo:     http://github.com/gerrproger/ext-helpers
 * Issues:   http://github.com/gerrproger/ext-helpers/issues
 */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t(e,document):"function"==typeof define&&define.amd?define(null,function(){t(e,document)}):e.ExtAutoInject=t(e,document)}("undefined"!=typeof window?window:this,function(e,t){"use strict";class o{constructor(t,o){if(this.isBackgroundScript=!(!chrome.extension.getBackgroundPage||chrome.extension.getBackgroundPage()!==e),this.manifest=chrome.runtime.getManifest(),!this.isBackgroundScript&&(o=t),o&&"function"!=typeof o)throw new Error("Callback should be a function!");if(this.isBackgroundScript&&t&&"string"!=typeof t&&"object"!=typeof t)throw new Error("Ignore parameter should be a sting (match pattern) or a regular expression or an array of strings/expressions!");return new Promise(s=>{const n=t=>{o&&o.call(e,t),s(t)};this.isBackgroundScript?this._background(t,n):this._content(n)})}_background(t,o){const s=e=>new RegExp(`^${e.replace(/\?/g,".").replace(/\*\.?/g,".*").replace(/\//g,"/").replace(/\./g,".")}$`),n=(n,c)=>{e.extAutoInjectInfo={date:new Date,version:this.manifest.version,previousVersion:c,reason:n},c&&o(this.constructor.info),!1!==t&&(()=>{this.manifest.content_scripts.forEach(e=>{const t=(e=>{const t={allFrames:e.all_frames,matchAboutBlank:e.match_about_blank,files:{}},o=o=>{t.files[o]=e[o].filter(e=>!r.some(t=>{if(e.match(t))return!0}))};return o("js"),o("css"),t})(e);chrome.tabs.query({url:e.matches},o=>{o&&o.forEach(o=>{let n=[];if(e.exclude_matches&&(n=n.concat(e.exclude_matches)),e.exclude_globs&&(n=n.concat(e.exclude_globs)),!n.some(e=>{if(e=s(e),o.url.match(e))return!0})){if(e.include_globs&&!e.include_globs.some(e=>{if(e=s(e),o.url.match(e))return!0}))return;((e,t)=>{const o=o=>{t.files[o].forEach(s=>{chrome.tabs["js"===o?"executeScript":"insertCSS"](e,{file:s,allFrames:t.allFrames,matchAboutBlank:t.matchAboutBlank})})};chrome.tabs.executeScript(e,{code:`window.extAutoInjectInfo = ${JSON.stringify(this.constructor.info)};`},()=>{if(chrome.runtime.lastError)switch(chrome.runtime.lastError.message){case"Cannot access contents of the page. Extension manifest must request permission to access the respective host.":case"The extensions gallery cannot be scripted.":case"The tab was closed.":return;default:throw new Error(chrome.runtime.lastError.message)}o("js"),o("css")})})(o.id,t)}})})})})()};let r="object"==typeof t||"string"==typeof t?Array.isArray(t)?t:[t]:[];r=r.map(e=>"string"==typeof e?s(e):e),chrome.runtime.onInstalled.addListener(e=>{n(e.reason,e.previousVersion)}),setTimeout(()=>{!this.constructor.info&&n("enabled")},1e3)}_content(t){const o=s=>{s.source===e&&s.data.extAutoInjected&&(e.removeEventListener("message",o),e.extAutoInjectInfo=s.data.extAutoInjected,t(this.constructor.info))};e.postMessage({extAutoInjected:this.constructor.info},"*"),setTimeout(()=>{e.addEventListener("message",o)})}static get info(){return e.extAutoInjectInfo}}return o});